<div class="ui container">
  <div class="ui items">
    <div class="item">
      <%= link_to user_path(@product.user), class: "ui image" do %>
        <%= image_tag @product.user.get_image(80,80), class: "img_status" %>
      <% end %>
      <div class="middle aligned content">
        <%= link_to @product.user.name, user_path(@product.user) %>
        <div class="description">
          <p>投稿日: <%= l @product.created_at %></p>
          <p>更新日: <%= l @product.updated_at %></p>
        </div>
      </div>
    </div>
  </div>

  <div class="ui center aligned grid">
    <%= image_tag @product.get_image(2000,2000), class: "thirteen wide column" %>
  </div>

  <!--タブ機能-->
  <div class="ui two item menu">
    <a class="active item" data-tab="product_show">成果物詳細</a>
    <a class="item" data-tab="feedbacks">フィードバック</a>
  </div>
  <!--タブ（成果物詳細）-->
  <div class="ui active tab segment" data-tab="product_show">
    <h2 class="ui dividing header"><%= @product.title %>
      <!--自分のだったら編集ボタン出す-->
      <% if current_user?(@product.user) %>
        <div class="ui right floated sub header">
          <p><%= link_to '編集する', edit_product_path(@product) %></p>
        </div>
      <% end %>

      <span id="favorite_btn_<%= @product.id %>" class="ui right floated sub header" style="padding-top: 2.1px;">
        <%= render partial: 'favorites/favorite_btn', locals: { product: @product } %>
      </span>

      <div class="sub header"><%= link_to @product.url, @product.url, target: "_blank", rel: "noopener noreferrer" %></div>
    </h2>

    <p><%= safe_join(@product.overview.split("\n"),tag(:br)) %></p>

    <div class="ui dividing large header">
      <i class="comment outline icon"></i>
      <div class="content">作成背景</div>
    </div>
    <p><%= safe_join(@product.background.split("\n"),tag(:br)) %></p>

    <div class="ui dividing large header">
      <i class="thumbtack icon"></i>
      <div class="content">使い方</div>
    </div>
    <p><%= safe_join(@product.usage.split("\n"),tag(:br)) %></p>

    <div class="ui dividing large header">
      <i class="lightbulb outline icon"></i>
      <div class="content">工夫点</div>
    </div>
    <p><%= safe_join(@product.ingenuity.split("\n"),tag(:br)) %></p>

    <div class="ui dividing large header">
      <i class="pencil alternate icon"></i>
      <div class="content">機能一覧</div>
    </div>
    <p><%= safe_join(@product.features.split("\n"),tag(:br)) %></p>

    <div class="ui dividing large header">
      <i class="code icon"></i>
      <div class="content">使用技術</div>
    </div>
    <p><%= safe_join(@product.technology.split("\n"),tag(:br)) %></p>

    <% if @product.other? %>
      <div class="ui dividing large header">
        <i class="info circle icon"></i>
        <div class="content">その他</div>
      </div>
      <p><%= safe_join(@product.other.split("\n"),tag(:br)) %></p>
    <% end %>
  </div>
  <!--タブ（フィードバック）-->
  <div class="ui tab segment" data-tab="feedbacks">
    <% if @feedbacks.empty? %>
      <p>この投稿にまだフィードバックはありません。</p>
    <% end %>
    <% @feedbacks.each do |feedback| %>
      <div class="ui piled segment">
        <div class="ui feed">
          <div class="event">
            <div class="label">
              <%= image_tag feedback.user.get_image(50,50), class: "img_status" %>
            </div>
            <div class="content">
              <div class="date"><%= l feedback.created_at %></div>
              <div class="summary">
                <%= link_to feedback.user.name, user_path(feedback.user) %>
              </div>
            </div>
            <% if feedback.user == current_user %>
              <div class="ui right aligned">
                <%= link_to product_feedback_path(feedback.product,feedback), method: :delete, data: {confirm: "コメントを削除しますか？"} do %>
                  <button class="ui icon inverted red button"><i class="trash alternate icon"></i></button>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>

        <div class="ui header">良かった点</div>
          <p><%= feedback.good_point %></p>
        <h3 class="ui header">改善点</h3>
          <p><%= feedback.improvement_point %></p>
        <% if feedback.other? %>
          <h3 class="ui header">その他</h3>
            <p><%= feedback.other %></p>
        <% end %>
      </div>
    <% end %>

    <!--フィードバックフォーム-->
    <h3>フィードバックを送る</h3>
    <div class="ui large form error">
      <%= form_with model: [@product,@product_feedback], local: true do |f| %>
        <%= render 'shared/error_messages', object: @product_feedback %>
        <div class="field">
          <%= f.label :good_point %>
          <%= f.text_area :good_point, rows: 7 %>
        </div>
        <div class="field">
          <%= f.label :improvement_point %>
          <%= f.text_area :improvement_point, rows: 7 %>
        </div>
        <div class="field">
          <%= f.label :other %>
          <%= f.text_area :other, rows: 2 %>
        </div>
        <%= f.submit '送信', class: "ui blue button" %>
      <% end %>
    </div>
  </div>
  <!--↑タブ機能おわり-->

</div>